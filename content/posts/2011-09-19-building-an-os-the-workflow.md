---
title: 'Building an OS: The workflow!'
author: herlo
layout: post
date: 2011-09-20T00:24:37+00:00
url: /2011/09/19/building-an-os-the-workflow/
categories:
  - Collaboration
  - Fedora
  - GoOSe
  - Koji
  - Tech
tags:
  - 2011
  - GoOSe
  - koji
  - linux
  - mock
  - OS
  - September
  - skein

---
Over the past few months, I've been working on a project which has inspired me to think about how a complete Operating System is built from the ground up. Luckily for me, this process is pretty well documented by the [Fedora Project][1].

The project I've been working on does require a bit of thought around enterprise Linux versions run by a community. There is the ever amazing [CentOS][2], [Scientific Linux][3] and a few others who have been around the block a time or two. The work that they have done has been immense and very helpful to many, including me.

For my project, the work was about building a fully binary compatible, enterprise-ready, community version of Linux, very similar to what CentOS and others have done. The question always comes 'why?' which will be addressed later on in future posts. Suffice it to say, the work we've been doing has paid off in both a individual and community sense.

In the beginning of this project, it was clear that we needed some tools to make things work the way we wanted. Luckily, there were tools out there to do a good portion of our work. Tools like [**koji**][4], [**mock**][5] and of course [**Linux**][6] to bring it all together. But other tools seemed to be missing and I went on a quest&#8230;

The first tool that seemed to be missing was a way to import src.rpms from the most popular upstream vendor. These packages needed to be rebuilt by koji in some fashion, but just taking the srpms and rebuilding them had been done before, and seems to be the preferred way to date. In my mind however, it seemed that we were missing a step. Enter [**skein**][7].

While skein is still very green and will need quite a bit more work, it accomplishes the goal of extracting the srpms into two parts. This tool basically sets up two things; a git repository on [github.com][8] (for now) along with a location and verifiable way to store the archive stored inside the srpm, called a lookaside cache. If one looks at the way the [Fedora Project maintains their source][9], this process is very similar.

Once the srpm is imported with skein, it can be built with koji. At the moment, this process is fairly manual, but the plan is to improve skein to also allow building from the repositories. However, another bit more automatic way to build would be to use a git hook. Luckily, github provides [several ways to accomplish this][10], including a custom URL to which an HTTP POST can be sent. At which time, koji would download the spec file and source from the appropriate locations and build a srpm.

Koji completes its task by building the binary RPM(s) and appropriately tagging the successful builds. Once complete, mash can be used to generate custom repositories to prepare for composing actual iso images. Mash is a command-line tool, again used by Fedora.

Once the repositories are generated by mash, [**pungi**][11] takes over. The process of building an iso is actually very simple, just a kickstart file, some repositories and pungi are used to create a fully installable DVD or multi-CD iso image.

Here's a bit of my **excellent artwork** to better describe the process.

[<img class="alignleft size-full wp-image-950" style="border: 0pt none; margin-left: 5px; margin-right: 5px;" title="OS Workflow" src="{{<siteurl>}}uploads/2011/09/goose-workflow_800x600.jpg" alt="" width="480" height="360" />][12]A couple things to note about this process is that while it is starting to become clear how to build an OS from an upstream vendor, there are parts that still haven't been addressed. Currently, we can import with skein and rebuild the SRPM and build the binary RPMs with koji. We yet to have enough binary RPMs to actually construct a buildroot, but we are getting very close.

Automating the builds with git hooks and a skein build process is a nice big step toward making our own Operating System possible.

The other big piece of the puzzle is dependency resolution. Now this has been mostly resolved by tools and apis like [Yum][13] and [RPM][14], but I still feel very much like a n00b when working with them. My hope is to figure out that process in the next week or so, and update skein to make building faster and easier overall.

Cheers,

herlo

 [1]: http://fedoraproject.org/wiki/ReleaseEngineering/Overview
 [2]: http://centos.org
 [3]: http://scientificlinux.org
 [4]: http://fedoraproject.org/wiki/Koji
 [5]: http://fedoraproject.org/wiki/Projects/Mock
 [6]: http://en.wikipedia.org/wiki/Linux
 [7]: https://github.com/gooseproject/skein
 [8]: https://github.com/organizations/gooseproject
 [9]: http://fedoraproject.org/wiki/Using_Fedora_GIT
 [10]: http://help.github.com/post-receive-hooks/
 [11]: https://fedorahosted.org/pungi/
 [12]: {{<siteurl>}}uploads/2011/09/goose-workflow_800x600.jpg
 [13]: http://yum.baseurl.org/
 [14]: http://rpm5.org/